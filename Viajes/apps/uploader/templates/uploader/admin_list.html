<!-- filepath: c:\Users\alberto\Documents\GitHub\INM-Viajes\Viajes\uploader\templates\uploader\admin_list.html -->
{% extends 'uploader/base.html' %}
{% load static %}

{% block title %}
    {% if is_superuser %}
        Registros - Admin | Viajes INM
    {% else %}
        Mis registros | Viajes INM
    {% endif %}
{% endblock %}


{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/admin_list.css' %}">
{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="flex justify-between items-center">
        <div>
            <h2 class="text-3xl font-bold">Gestión de Registros de Viaje</h2>
            <p class="text-gray-600 mt-2">Total: <span id="total-registros">{{ page_obj.paginator.count }}</span> registros</p>
            
            <!-- Leyenda de colores -->
            <div class="flex gap-4 mt-3 text-lg">
                <div class="flex items-center gap-2">
                    <span class="badge badge-success gap-1 font-bold">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        SR
                    </span>
                    <span class="text-gray-600 font-bold">Segunda Revisión</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="badge badge-error gap-1 font-bold">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        R
                    </span>
                    <span class="text-gray-600 font-bold">Rechazo</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="badge badge-info gap-1 font-bold">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                        </svg>
                        I
                    </span>
                    <span class="text-gray-600 font-bold">Internación</span>
                </div>
            </div>
        </div>
        <div class="flex gap-3">
            <!-- Notificaciones -->
            <a href="{% url 'notificaciones_list' %}" class="btn btn-ghost btn-circle btn-lg relative" title="Notificaciones">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                </svg>
                {% if notificaciones_no_leidas > 0 %}
                <span class="badge badge-error badge-sm absolute -top-1 -right-1">{{ notificaciones_no_leidas }}</span>
                {% endif %}
            </a>
            
            <!-- Casos Especiales -->
            <a href="{% url 'casos_especiales_list' %}" class="btn btn-warning btn-circle btn-lg" title="Casos Especiales">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
            </a>
            
            <!-- Búsqueda por Fecha -->
            <a href="{% url 'date_range_report' %}" class="btn btn-info btn-circle btn-lg" title="Búsqueda por Fecha">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="currentColor" viewBox="0 0 384 512">
                    <path d="M32 32C32 14.3 46.3 0 64 0H320c17.7 0 32 14.3 32 32s-14.3 32-32 32H290.5l11.4 148.2c36.7 19.9 65.7 53.2 79.5 94.7l1 3c3.3 9.8 1.6 20.5-4.4 28.8s-15.7 13.3-26 13.3H32c-10.3 0-19.9-5-26-13.3s-7.7-19.1-4.4-28.8l1-3c13.8-41.5 42.8-74.8 79.5-94.7L93.5 64H64C46.3 64 32 49.7 32 32zM160 384h64v96c0 17.7-14.3 32-32 32s-32-14.3-32-32V384z"/>
                </svg>
            </a>
            
            <!-- Subir Excel -->
            <a href="{% url 'upload_excel' %}" class="btn btn-success btn-lg gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                </svg>
                Subir Excel
            </a>
        </div>
    </div>

     <!-- Filtros Mejorados -->
    <div class="card bg-base-100 shadow-md">
        <div class="card-body">
            <div class="flex flex-wrap gap-4 items-center">
                <!-- Buscador de Documento (Principal) -->
                <div class="form-control flex-1 min-w-[300px]">
                    <label class="label">
                        <span class="label-text font-semibold">Buscar por Documento o Pasajero</span>
                    </label>
                    <div class="relative">
                        <input 
                            type="text" 
                            id="searchInput" 
                            placeholder="Escribe número de documento o nombre..." 
                            class="input input-bordered w-full pr-10"
                            value="{{ request.GET.search }}"
                        >
                        <button 
                            id="clearSearch" 
                            class="btn btn-ghost btn-sm absolute right-1 top-1/2 -translate-y-1/2 hidden"
                            onclick="clearSearchFilter()"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Lote de Carga -->
                <div class="form-control w-full max-w-xs">
                    <label class="label">
                        <span class="label-text font-semibold">Lote de Carga</span>
                    </label>
                    <select name="batch" id="batchFilter" class="select select-bordered">
                        <option value="">Todos los lotes</option>
                        {% for batch in batches %}
                        <option value="{{ batch.id }}" {% if request.GET.batch == batch.id|stringformat:"s" %}selected{% endif %}>
                            Lote #{{ batch.id }} - {{ batch.usuario.username }} ({{ batch.fecha_carga|date:"d/m/Y H:i" }})
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Filtros Rápidos -->
                <div class="form-control">
                    <label class="label">
                        <span class="label-text font-semibold">Filtros Rápidos</span>
                    </label>
                    <div class="flex gap-2">
                        <!-- Segunda Revisión (Checkbox independiente) -->
                        <label class="btn btn-sm {% if request.GET.segunda_revision == 'true' %}btn-success{% else %}btn-ghost{% endif %} gap-2 cursor-pointer" title="Segunda Revisión">
                            <input 
                                type="checkbox" 
                                id="segundaRevisionFilter" 
                                class="checkbox checkbox-xs"
                                {% if request.GET.segunda_revision == 'true' %}checked{% endif %}
                            >
                            <span>SR</span>
                        </label>

                        <!-- Rechazo (Radio button con Internación) -->
                        <label class="btn btn-sm {% if request.GET.rechazado == 'true' %}btn-error{% else %}btn-ghost{% endif %} gap-2 cursor-pointer" title="Rechazo">
                            <input 
                                type="radio" 
                                name="filtro_exclusivo"
                                id="rechazadoFilter" 
                                class="radio radio-xs"
                                {% if request.GET.rechazado == 'true' %}checked{% endif %}
                            >
                            <span>R</span>
                        </label>

                        <!-- Internación (Radio button con Rechazo) -->
                        <label class="btn btn-sm {% if request.GET.internacion == 'true' %}btn-info{% else %}btn-ghost{% endif %} gap-2 cursor-pointer" title="Punto de Internación">
                            <input 
                                type="radio" 
                                name="filtro_exclusivo"
                                id="internacionFilter" 
                                class="radio radio-xs"
                                {% if request.GET.internacion == 'true' %}checked{% endif %}
                            >
                            <span>I</span>
                        </label>
                    </div>
                </div>

                <!-- Botón Limpiar -->
                <div class="form-control">
                    <label class="label opacity-0">
                        <span class="label-text">-</span>
                    </label>
                    <a href="{% url 'admin_list' %}" class="btn btn-ghost gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>
                        Limpiar Todo
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabla de Registros -->
    <div class="card bg-base-100 shadow-md">
        <div class="card-body p-0">
            <div class="overflow-x-auto">
                <table class="table table-zebra" id="registrosTable">
                    <thead>
                        <tr class="bg-primary text-primary-content">
                            <!-- Campos Administrativos (Izquierda) -->
                            <th class="sticky left-0 z-10 bg-primary text-center" title="Segunda Revisión">SR</th>
                            <th class="sticky left-[60px] z-10 bg-primary text-center" title="Rechazo">R</th>
                            <th class="sticky left-[120px] z-10 bg-primary text-center" title="Punto de Internación">I</th>
                            <th class="sticky left-[180px] z-10 bg-primary">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />
                                </svg>
                                Comentario
                            </th>
                            <th class="sticky left-[360px] z-10 bg-primary">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                </svg>
                                Acciones
                            </th>
                            
                            <!-- Campos del Excel -->
                            <th>Vuelo</th>
                            <th>Fecha Vuelo</th>
                            <th>Salida</th>
                            <th>Llegada</th>
                            <th>Hora Salida</th>
                            <th>Pasajero</th>
                            <th>Documento</th>
                            <th>Asiento</th>
                            <th>Equipaje</th>
                            <th>Piezas</th>
                            <th>Peso</th>
                            <th>Estado Check-in</th>
                            <th>Contacto General</th>
                            <th>Contacto Reserva</th>
                            <th>Contacto Pasajero</th>
                            <th>Ticket</th>
                            <th>Fecha Nacimiento</th>
                            <th>Género</th>
                            <th>Código País</th>
                            <th>País Emisión</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for registro in page_obj %}
                        <tr id="registro-{{ registro.id }}"
                            data-documento="{{ registro.numero_documento|default:'' }}" 
                            data-pasajero="{{ registro.nombre_pasajero|default:''|lower }}">

                            <!-- CAMPOS ADMINISTRATIVOS (FIJOS A LA IZQUIERDA) -->
                            <!-- SR - Segunda Revisión (Siempre activo) -->
                            <td class="sticky left-0 z-10 text-center bg-base-100">
                                <form method="post" action="{% url 'update_registro' registro.id %}?{{ request.GET.urlencode }}" class="inline">
                                    {% csrf_token %}
                                    <input type="hidden" name="segunda_revision" value="{% if registro.segunda_revision %}false{% else %}true{% endif %}">
                                    <button type="submit" class="btn btn-ghost btn-sm" title="Segunda Revisión">
                                        {% if registro.segunda_revision %}
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-success" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                        {% else %}
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                        {% endif %}
                                    </button>
                                </form>
                            </td>
                            
                            <!-- R - Rechazo (Solo se habilita cuando SR está activo, SI I está activo, R se desactiva) -->
                            <td class="sticky left-[60px] z-10 text-center bg-base-100">
                                <form method="post" action="{% url 'update_registro' registro.id %}?{{ request.GET.urlencode }}" class="inline">
                                    {% csrf_token %}
                                    <input type="hidden" name="rechazado" value="{% if registro.rechazado %}false{% else %}true{% endif %}">
                                    <button type="submit" class="btn btn-ghost btn-sm" 
                                            title="Rechazo"
                                            {% if  not registro.segunda_revision %}disabled{% endif %}>
                                        {% if registro.rechazado %}
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-error" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                        {% else %}
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                        {% endif %}
                                    </button>
                                </form>
                            </td>
                            
                            <!-- I - Internación (Solo se habilita si SR está activo) -->
                            <td class="sticky left-[120px] z-10 text-center bg-base-100">
                                <form method="post" action="{% url 'update_registro' registro.id %}?{{ request.GET.urlencode }}" class="inline">
                                    {% csrf_token %}
                                    <input type="hidden" name="internacion" value="{% if registro.internacion %}false{% else %}true{% endif %}">
                                    <button type="submit" class="btn btn-ghost btn-sm" 
                                            title="Punto de Internación"
                                            {% if not registro.segunda_revision %}disabled{% endif %}>
                                        {% if registro.internacion %}
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-info" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                                        </svg>
                                        {% else %}
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 {% if registro.segunda_revision %}text-gray-400{% else %}text-gray-200{% endif %}" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                                        </svg>
                                        {% endif %}
                                    </button>
                                </form>
                            </td>
                            
                            <!-- Comentario -->
                            <td class="sticky left-[180px] z-10 bg-base-100">
                                <div class="max-w-[170px] truncate text-xs" title="{{ registro.comentario }}">
                                    {% if registro.comentario %}
                                    {{ registro.comentario }}
                                    {% else %}
                                    <span class="text-gray-400">-</span>
                                    {% endif %}
                                </div>
                            </td>
                            
                            <!-- Acciones -->
                            <td class="sticky left-[360px] z-10 text-center bg-base-100">
                                <button onclick="openEditModal({{ registro.id }}, '{{ registro.comentario|default:""|escapejs }}')" 
                                        class="btn btn-sm btn-accent">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                    </svg>
                                </button>
                            </td>
                            
                            <!-- CAMPOS DEL EXCEL -->
                            <td><strong>{{ registro.vuelo_numero }}</strong></td>
                            <td>
                                {% if registro.vuelo_fecha %}
                                {{ registro.vuelo_fecha|date:"d/m/Y" }}
                                {% else %}
                                <span class="text-gray-400">-</span>
                                {% endif %}
                            </td>
                            <td><span class="badge badge-outline badge-sm">{{ registro.aeropuerto_salida }}</span></td>
                            <td><span class="badge badge-outline badge-sm">{{ registro.aeropuerto_llegada }}</span></td>
                            <td class="text-xs">{{ registro.salida_planificada|default:"-" }}</td>
                            <td class="font-semibold">{{ registro.nombre_pasajero }}</td>
                            <td><code class="text-md">{{ registro.numero_documento }}</code></td>
                            <td><span class="badge badge-primary badge-sm">{{ registro.numero_asiento }}</span></td>
                            <td class="text-xs max-w-[200px] truncate" title="{{ registro.numero_equipaje }}">
                                {{ registro.numero_equipaje|default:"-" }}
                            </td>
                            <td class="text-center">{{ registro.piezas }}</td>
                            <td class="text-center">{{ registro.peso }} kg</td>
                            <td><span class="badge badge-ghost badge-sm">{{ registro.estado_checkin }}</span></td>
                            <td class="text-xs max-w-[150px] truncate" title="{{ registro.informacion_contacto }}">
                                {{ registro.informacion_contacto|default:"-" }}
                            </td>
                            <td class="text-xs">{{ registro.contacto_reserva|default:"-" }}</td>
                            <td class="text-xs">{{ registro.contacto_pasajero|default:"-" }}</td>
                            <td class="font-mono text-xs">{{ registro.numero_ticket }}</td>
                            <td class="text-xs">
                                {% if registro.fecha_nacimiento %}
                                {{ registro.fecha_nacimiento|date:"d/m/Y" }}
                                {% else %}
                                -
                                {% endif %}
                            </td>
                            <td class="text-center">
                                {% if registro.genero == 'M' %}
                                <span class="badge badge-info badge-sm">M</span>
                                {% elif registro.genero == 'F' %}
                                <span class="badge badge-secondary badge-sm">F</span>
                                {% else %}
                                {{ registro.genero }}
                                {% endif %}
                            </td>
                            <td class="text-xs">{{ registro.codigo_pais_emision }}</td>
                            <td>{{ registro.pais_emision }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="25" class="text-center py-8">
                                <div class="flex flex-col items-center gap-4">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                    </svg>
                                    <p class="text-gray-500 text-lg font-semibold">No se encontraron registros</p>
                                    <p class="text-gray-400 text-sm">Intenta ajustar los filtros o la búsqueda</p>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Paginación -->
    {% if page_obj.has_other_pages %}
    <div class="flex justify-center">
        <div class="join">
            {% if page_obj.has_previous %}
            <a href="?page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.batch %}&batch={{ request.GET.batch }}{% endif %}{% if request.GET.segunda_revision %}&segunda_revision={{ request.GET.segunda_revision }}{% endif %}{% if request.GET.rechazado%}&rechazado={{ request.GET.rechazado}}{% endif %}{% if request.GET.internacion %}&internacion={{ request.GET.internacion }}{% endif %}" 
               class="join-item btn btn-sm">«</a>
            <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.batch %}&batch={{ request.GET.batch }}{% endif %}{% if request.GET.segunda_revision %}&segunda_revision={{ request.GET.segunda_revision }}{% endif %}{% if request.GET.rechazado%}&rechazado={{ request.GET.rechazado}}{% endif %}{% if request.GET.internacion %}&internacion={{ request.GET.internacion }}{% endif %}" 
               class="join-item btn btn-sm">‹</a>
            {% endif %}
            
            <button class="join-item btn btn-sm btn-active">
                Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
            </button>
            
            {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.batch %}&batch={{ request.GET.batch }}{% endif %}{% if request.GET.segunda_revision %}&segunda_revision={{ request.GET.segunda_revision }}{% endif %}{% if request.GET.rechazado%}&rechazado={{ request.GET.rechazado}}{% endif %}{% if request.GET.internacion %}&internacion={{ request.GET.internacion }}{% endif %}" 
               class="join-item btn btn-sm">›</a>
            <a href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.batch %}&batch={{ request.GET.batch }}{% endif %}{% if request.GET.segunda_revision %}&segunda_revision={{ request.GET.segunda_revision }}{% endif %}{% if request.GET.rechazado%}&rechazado={{ request.GET.rechazado}}{% endif %}{% if request.GET.internacion %}&internacion={{ request.GET.internacion }}{% endif %}" 
               class="join-item btn btn-sm">»</a>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>

<!-- Modal para Editar Comentario -->
<dialog id="editModal" class="modal">
    <div class="modal-box">
        <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
            </svg>
            Editar Comentario
        </h3>
        <form method="post" id="editForm">
            {% csrf_token %}
            <div class="form-control">
                <label class="label">
                    <span class="label-text">Comentario</span>
                </label>
                <textarea name="comentario" id="comentario" class="textarea textarea-bordered h-32" placeholder="Escribe un comentario..."></textarea>
            </div>
            <div class="modal-action">
                <button type="button" onclick="closeEditModal()" class="btn btn-ghost">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                    Cancelar
                </button>
                <button type="submit" class="btn btn-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                    Guardar
                </button>
            </div>
        </form>
    </div>
    <form method="dialog" class="modal-backdrop">
        <button>close</button>
    </form>
</dialog>

    <!-- Modal para Subir Foto de Rechazo -->
<dialog id="modalFotoRechazo" class="modal">
    <div class="modal-box">
        <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-error" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            Subir Foto de Rechazo
        </h3>
        
        <p class="text-sm text-base-content/70 mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            Por favor, sube una foto del documento o pasajero rechazado.
        </p>
        
        <form id="formFotoRechazo" onsubmit="subirFotoRechazo(event)" enctype="multipart/form-data">
            {% csrf_token %}
            
            <div class="form-control mb-4">
                <label class="label">
                    <span class="label-text font-semibold">Seleccionar Foto</span>
                </label>
                <input 
                    type="file" 
                    id="inputFotoRechazo"
                    name="foto" 
                    accept="image/jpeg,image/jpg,image/png,image/webp"
                    class="file-input file-input-bordered file-input-primary w-full" 
                    required
                >
                <label class="label">
                    <span class="label-text-alt">Formatos: JPG, JPEG, PNG, WEBP. También puedes pegar (Ctrl+V) desde portapapeles</span>
                </label>
            </div>
            
            <!-- Preview de la imagen -->
            <div id="previewFotoRechazo" class="mb-4 hidden">
                <label class="label">
                    <span class="label-text font-semibold">Vista previa</span>
                </label>
                <div class="relative">
                    <img id="imgPreviewRechazo" class="rounded-lg border-2 border-base-300 max-h-64 w-full object-contain" alt="Preview">
                    <button type="button" onclick="limpiarFotoRechazo()" class="btn btn-error btn-sm absolute top-2 right-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                        Eliminar
                    </button>
                </div>
            </div>
            
            <div class="form-control mb-4">
                <label class="label">
                    <span class="label-text font-semibold flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />
                        </svg>
                        Comentario del rechazo
                    </span>
                </label>
                <textarea 
                    id="comentarioRechazo"
                    name="comentario" 
                    class="textarea textarea-bordered" 
                    rows="3"
                    placeholder="Escribe el motivo del rechazo o detalles adicionales..."></textarea>
                <label class="label">
                    <span class="label-text-alt">Este comentario se guardará en el registro</span>
                </label>
            </div>
            
            <div class="modal-action">
                <button type="button" onclick="document.getElementById('modalFotoRechazo').close()" class="btn btn-ghost">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                    Cancelar
                </button>
                <button type="submit" class="btn btn-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    Subir Foto
                </button>
            </div>
        </form>
    </div>
    <form method="dialog" class="modal-backdrop">
        <button>close</button>
    </form>
</dialog>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/admin_list.js' %}"></script>
{% endblock %}